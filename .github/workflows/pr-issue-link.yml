name: PR Issue Link Enforcement

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  enforce-issue-link:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR body contains issue reference
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const body = (pr.body || "").toLowerCase();

            // Acceptable patterns:
            // closes #123, fixes #123, resolves #123, refs #123
            const re = /(closes|fixes|resolves|refs)\s+#\d+/i;

            if (!re.test(body)) {
              core.setFailed(
                "PR must reference an issue in the body. Example: 'Closes #123' (also accepts Fixes/Resolves/Refs)."
              );
            } else {
              console.log("Issue reference found in PR body.");
            }
